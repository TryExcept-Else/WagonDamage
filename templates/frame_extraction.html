{% extends 'base.html' %} {% block title %}Frame Extraction - Wagon Damage
Detection System{% endblock %} {% block page_styles %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/upload.css') }}"
/>
<style>
  #videoPreviewCard,
  #processingCard {
    display: none;
  }

  .progress {
    height: 25px;
    font-size: 1rem;
  }
</style>
{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-md-12">
    <h2 class="page-title">
      <i class="fas fa-object-group me-2 text-success"></i>Frame Extraction
    </h2>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="{{ url_for('index') }}">Home</a>
        </li>
        <li class="breadcrumb-item active">Frame Extraction</li>
      </ol>
    </nav>
    <hr />
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm mb-4" id="uploadCard">
      <div class="card-header bg-light">
        <h5 class="mb-0">
          <i class="fas fa-video me-2"></i>Upload Video for Extraction
        </h5>
      </div>
      <div class="card-body">
        <form
          id="extractionForm"
          method="POST"
          action="{{ url_for('frame_extraction') }}"
          enctype="multipart/form-data"
        >
          <div class="mb-3">
            <label for="videoFile" class="form-label"
              >Select a video file:</label
            >
            <input
              type="file"
              class="form-control"
              id="videoFile"
              name="video"
              accept="video/*"
              required
            />
            <div class="form-text">
              Upload a video to extract frames with wagons.
            </div>
          </div>
          <div class="text-center">
            <button
              type="submit"
              id="submitBtn"
              class="btn btn-success btn-lg"
              disabled
            >
              <i class="fas fa-cogs me-2"></i>Start Extraction
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mb-4" id="videoPreviewCard">
      <div class="card-header bg-light">
        <h5 class="mb-0">
          <i class="fas fa-play-circle me-2"></i>Video Preview
        </h5>
      </div>
      <div class="card-body text-center">
        <video id="videoPlayer" class="img-fluid rounded" controls></video>
        <p id="videoFileName" class="mt-2 text-muted"></p>
      </div>
    </div>

    <div class="card shadow-sm mb-4" id="processingCard">
      <div class="card-header bg-light">
        <h5 class="mb-0">
          <i class="fas fa-sync-alt fa-spin me-2"></i>Processing Video
        </h5>
      </div>
      <div class="card-body text-center p-5">
        <div
          class="spinner-border text-primary"
          role="status"
          style="width: 3rem; height: 3rem"
        >
          <span class="visually-hidden">Loading...</span>
        </div>
        <h4 class="mt-3">Extracting frames, please wait...</h4>
        <p class="text-muted">
          This may take several minutes depending on the video length.
        </p>
        <div class="progress mt-4">
          <div
            id="progressBar"
            class="progress-bar progress-bar-striped progress-bar-animated"
            role="progressbar"
            style="width: 0%"
            aria-valuenow="0"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            0%
          </div>
        </div>
      </div>
    </div>

    {% if frames %}
    <div class="card shadow-sm" id="resultsCard">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-images me-2"></i>Extraction Results
        </h5>
      </div>
      <div class="card-body">
        <div class="alert alert-success">
          Successfully extracted {{ frames|length }} frames.
        </div>
        <div class="row">
          {% for frame_data_url in frames %}
          <div class="col-lg-3 col-md-4 col-6 mb-4">
            <a href="{{ frame_data_url }}" target="_blank">
              <img
                src="{{ frame_data_url }}"
                class="img-fluid rounded shadow-sm"
                alt="Extracted Frame"
              />
            </a>
          </div>
          {% endfor %}
        </div>
        <div class="text-center mt-3">
          <a href="{{ url_for('frame_extraction') }}" class="btn btn-primary">
            <i class="fas fa-redo me-2"></i>Start New Extraction
          </a>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block page_scripts %}
<script src="{{ url_for('static', filename='js/frame_extraction.js') }}"></script>
{% endblock %}
